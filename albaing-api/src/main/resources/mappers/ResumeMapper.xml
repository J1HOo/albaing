<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jobjob.albaing.mapper.ResumeMapper">


    <!--이력서 자동 생성-->


<!--    user 불러오기-->
    <select id="getUserById">
        SELECT *
        FROM USERS
        WHERE user_id = #{userId}
    </select>

<!--    //내 정보 수정-->
    <update id="updateUser">
        UPDATE USERS
        SET
            user_email = #{userEmail},
            user_profile_image = #{userProfileImage},
            user_address = #{userAddress}
        WHERE user_id = #{userId}
    </update>

<!--    이력서 상세조회-->
    <select id="resumeDetails">
        SELECT
            r.resume_id,
            r.resume_title,
            r.resume_location,
            r.resume_job_category,
            r.resume_job_type,
            r.resume_job_duration,
            r.resume_work_schedule,
            r.resume_work_time,
            r.resume_job_skill,
            r.resume_introduction,
            e.edu_degree,
            e.edu_status,
            e.edu_school,
            e.edu_major,
            e.edu_admission_year,
            e.edu_graduation_year,
            c.career_company_name,
            c.career_join_date,
            c.career_quit_date,
            c.career_job_description
        FROM RESUMES r
                 LEFT JOIN EDUCATION_HISTORIES e ON r.resume_id = e.resume_id
                 LEFT JOIN CAREER_HISTORIES c ON r.resume_id = c.resume_id
        WHERE r.resume_id = #{resumeId}
    </select>

<!--    //이력서 insert-->
    <insert id="insertResume" parameterType="com.jobjob.albaing.dto.ResumeUpdateRequest">
        INSERT INTO RESUMES (user_id,resume_title, resume_location,
                            resume_job_category, resume_job_type, resume_job_duration,
                            resume_work_schedule, resume_work_time, resume_job_skill,
                            resume_introduction)
        VALUES (#{resume.userId},#{resume.resumeTitle}, #{resume.resumeLocation},
                #{resume.resumeJobCategory}, #{resume.resumeJobType}, #{resume.resumeJobDuration},
                #{resume.resumeWorkSchedule}, #{resume.resumeWorkTime}, #{resume.resumeJobSkill},
                #{resume.resumeIntroduction})
    </insert>

<!--    -->
    <insert id="createResumeForUser" useGeneratedKeys="true" keyProperty="resumeId">
        INSERT INTO RESUMES (
            user_id,
            resume_title,
            resume_location,
            resume_job_category,
            resume_job_type,
            resume_job_duration,
            resume_work_schedule,
            resume_work_time,
            resume_job_skill,
            resume_introduction
        ) VALUES (
                     #{userId},
                     #{resumeTitle},
                     #{resumeLocation},
                     #{resumeJobCategory},
                     #{resumeJobType},
                     #{resumeJobDuration},
                     #{resumeWorkSchedule},
                     #{resumeWorkTime},
                     #{resumeJobSkill},
                     #{resumeIntroduction}
                 )
    </insert>

    <!-- 기본 학력 정보 생성 -->
    <insert id="createDefaultEducation">
        INSERT INTO EDUCATION_HISTORIES (
            resume_id,
            edu_degree,
            edu_status,
            edu_school,
            edu_major,
            edu_admission_year,
            edu_graduation_year
        ) VALUES (
                     #{resumeId},
                     #{eduDegree},
                     #{eduStatus},
                     #{eduSchool},
                     #{eduMajor},
                     #{eduAdmissionYear},
                     #{eduGraduationYear}
                 )
    </insert>

    <!-- 기본 경력 정보 생성 -->
    <insert id="createDefaultCareer">
        INSERT INTO CAREER_HISTORIES (
            resume_id,
            career_company_name,
            career_join_date,
            career_quit_date,
            career_job_description,
            career_is_career
        ) VALUES (
                     #{resumeId},
                     #{careerCompanyName},
                     #{careerJoinDate},
                     #{careerQuitDate},
                     #{careerJobDescription},
                     #{careerIsCareer}
                 )
    </insert>



<!--    //이력서 수정 -->
<update id="updateResume">
    UPDATE RESUMES
    SET
        resume_title = #{resume.resumeTitle},
        resume_location = #{resume.resumeLocation},
        resume_job_category = #{resume.resumeJobCategory},
        resume_job_type = #{resume.resumeJobType},
        resume_job_duration = #{resume.resumeJobDuration},
        resume_work_schedule = #{resume.resumeWorkSchedule},
        resume_work_time= #{resume.resumeWorkTime},
        resume_job_skill= #{resume.resumeJobSkill},
        resume_introduction = #{resume.resumeIntroduction}
    WHERE resume_id = #{resume.resumeId}
</update>


    <!-- 이력서 수정 (학력) -->
    <update id="updateEducation">
        UPDATE EDUCATION_HISTORIES
        SET
            edu_degree = #{eduDegree},
            edu_status = #{eduStatus},
            edu_school = #{eduSchool},
            edu_major = #{eduMajor},
            edu_admission_year = #{eduAdmissionYear},
            edu_graduation_year = #{eduGraduationYear}
        WHERE resume_id = #{resumeId}
    </update>


<!--    이력서 수정 ( 경력) -->
    <update id="updateCareer">
        UPDATE CAREER_HISTORIES
        SET
            career_company_name = #{careerCompanyName},
            career_join_date = #{careerJoinDate},
            career_quit_date = #{careerQuitDate},
            career_job_description = #{careerJobDescription},
            career_is_career = #{careerIsCareer}
        WHERE resume_id = #{resumeId}
    </update>

<!--    학력 삭제 -->


<!--    경력 삭제 -->


</mapper>